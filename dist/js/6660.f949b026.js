"use strict";(self["webpackChunkSPRC_NDERMS"]=self["webpackChunkSPRC_NDERMS"]||[]).push([[6660],{49023:(t,e,n)=>{n.d(e,{A:()=>u});var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-loading"},[n("div",{staticClass:"box"},[n("hash-loader",{staticClass:"custom-class",attrs:{color:"#1e1450",loading:!0,size:40,sizeUnit:"px"}}),n("h5",{staticClass:"app-name"},[t._v(t._s(t.text))])],1)])},s=[];const o={name:"app-user-logging-in",props:{text:String}},r=o;var i=n(81656),c=(0,i.A)(r,a,s,!1,null,"e542c458",null);const u=c.exports},4721:(t,e,n)=>{n.d(e,{A:()=>u});var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._t("default")],2)},s=[];const o={name:"LayoutMain",components:{}},r=o;var i=n(81656),c=(0,i.A)(r,a,s,!1,null,null,null);const u=c.exports},66660:(t,e,n)=>{n.r(e),n.d(e,{default:()=>m});var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-body",attrs:{id:"page-login"}},[t.isLoading?t._e():n("div",{staticClass:"login-panel"},[n("img",{staticClass:"app-background",attrs:{src:"/img/banner.png",alt:"app background image"}}),n("div",{staticClass:"form-login"},[n("img",{staticClass:"app-logo",attrs:{src:t.appIcon,alt:"app icon"}}),t._m(0),n("button",{staticClass:"signin",on:{click:function(e){return t.SIGN_IN_GUEST()}}},[t._v("Sign In")]),n("button",{staticClass:"microsoft",on:{click:t.SIGN_IN}},[n("img",{attrs:{src:"/img/microsoft.svg",alt:"microsoft"}}),t._v(" Login with Microsoft ")]),t._m(1)])]),1==t.isLoading?n("PageLoading",{attrs:{text:"Logging In"}}):t._e()],1)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-description"},[n("h2",[t._v("CPOC IMS")]),n("h1",[t._v("INSPECTION & MAINTENANCE SYSTEM")]),n("h3",[t._v("CARIGALI-PTTEPI Operating Company Sdn. Bhd.")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"footer"},[n("span",[t._v("2024 â’¸ Designed and developed by")]),n("img",{attrs:{src:"/img/dexon.svg",alt:"dexon"}})])}],o=n(30388),r=(n(5086),n(30959),n(98741),n(61373),n(88704)),i=n(41355),c=n(4721),u=n(49023);const l={name:"Login-View",components:{PageLoading:u.A},data:function(){return{appIcon:this.$store.state.appIcon,isLoggedIn:localStorage.getItem("user"),isLoading:!1,current_tab:1,formData:{username:"",name:"",uniqueId:""}}},created:function(){this.$emit("update:layout",c.A),this.$store.commit("CLEAR_CURRENT_INAPP"),this.isLoggedIn&&this.$router.push("/")},methods:{FETCH_USER_ID:function(t,e){return(0,o.A)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:(0,r.p)({method:"get",url:"https://graph.microsoft.com/v1.0/users?$filter=identities/any(c:c/issuerAssignedId eq '".concat(t,"')&$select=id"),headers:{Authorization:"Bearer ".concat(e)},data:{}}).then((function(t){return t.data.value[0].id}))["catch"]((function(t){console.log(t)}));case 1:case"end":return n.stop()}}),n)})))()},FETCH_USER_PHOTO:function(t,e){var n=this;return(0,o.A)(regeneratorRuntime.mark((function a(){var s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n.FETCH_USER_ID(t,e);case 2:s=a.sent,(0,r.p)({method:"get",url:"https://graph.microsoft.com/v1.0/users/".concat(s,"/photo/$value"),headers:{responseType:"arraybuffer"},data:{}}).then((function(t){return t.data}))["catch"]((function(t){console.log(t)}));case 4:case"end":return a.stop()}}),a)})))()},SIGN_IN_GUEST:function(){var t=this,e="GUEST",n="guest@dexon-technology.com",a="51fca672-f9b4-49b3-8100-c414ec703509",s="";(0,r.p)({method:"post",url:"/User/login",data:{name:e,username:n,uniqueId:a,img:s}}).then((function(e){e.data.user&&e.data.token&&(localStorage.setItem("user",JSON.stringify(e.data.user)),localStorage.setItem("token",JSON.stringify(e.data.token)),console.log("==> SIGNED IN USER: "),console.log(e.data.user),t.$router.push("/"))}))["catch"]((function(e){e.response?(e.response.data&&t.$ons.notification.alert(e.response.data.message),0==e.response.status&&t.$ons.notification.alert("Cannot connect to a server.<br/> Please try again later.")):console.log(e)}))["finally"]((function(){t.isLoading=!1}))},SIGN_IN:function(){var t=this;return(0,o.A)(regeneratorRuntime.mark((function e(){var n,a,s,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,i.Jv)();case 3:n=e.sent,a=t.FETCH_USER_PHOTO(n.uniqueId,n.accessToken),console.log("authResult",n),s=n.account.name,o=n.account.username,c=n.uniqueId,console.log("login",s,o,c),(0,r.p)({method:"post",url:"/User/login",data:{name:s,username:o,uniqueId:c,img:a}}).then((function(e){e.data.user&&e.data.token&&(localStorage.setItem("user",JSON.stringify(e.data.user)),localStorage.setItem("token",JSON.stringify(e.data.token)),console.log("==> SIGNED IN USER: "),console.log(e.data.user),t.$router.push("/"))}))["catch"]((function(e){e.response?(e.response.data&&t.$ons.notification.alert(e.response.data.message),0==e.response.status&&t.$ons.notification.alert("Cannot connect to a server.<br/> Please try again later.")):console.log(e)}))["finally"]((function(){t.isLoading=!1})),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),console.error("Sign-in error:",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()}}},g=l;var d=n(81656),p=(0,d.A)(g,a,s,!1,null,"1bcb9728",null);const m=p.exports}}]);
//# sourceMappingURL=6660.f949b026.js.map